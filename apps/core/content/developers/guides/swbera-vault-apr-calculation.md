---
head:
  - - meta
    - property: og:title
      content: SWBERA Vault APR Calculation
  - - meta
    - name: description
      content: How to calculate the Annual Percentage Rate (APR) for the SWBERA staker vault
  - - meta
    - property: og:description
      content: How to calculate the Annual Percentage Rate (APR) for the SWBERA staker vault
---

<script setup>
  import config from '@berachain/config/constants.json';
  import { ref, onMounted } from 'vue'
  import { ethers } from 'ethers'
</script>

# SWBERA Vault APR Calculation

This guide explains how to calculate the Annual Percentage Rate (APR) for the SWBERA staker vault using the `previewRedeem` function.

## Overview

The SWBERA vault APR is calculated by measuring the change in share value over a 24-hour period and annualizing the return. This provides a real-time view of the yield being generated by the vault.

## Calculation Method

### Step 1: Get Share Value

Use the `previewRedeem` function to determine how much WBERA you would receive for 1 share:

```solidity
function previewRedeem(uint256 shares) external view returns (uint256 assets)
```

**Parameters:**

- `shares`: Number of shares (use 1 share with 18 decimals: `1000000000000000000`)

**Returns:**

- `assets`: Amount of WBERA you would receive for the given shares

### Step 2: Calculate 24-Hour Return

1. Get the current share value: `previewRedeem(1e18)` at current block
2. Get the share value 24 hours ago: `previewRedeem(1e18)` at block 24 hours ago
3. Calculate the difference: `current_value - previous_value`

### Step 3: Annualize the Return

Multiply the 24-hour return by 365 to get the annualized rate:

$$\text{APR} = \frac{\text{Current Share Value} - \text{Previous Share Value}}{\text{Previous Share Value}} \times 365 \times 100$$

## Live APR Calculation

<script setup>
import { ref, onMounted } from 'vue'
import { ethers } from 'ethers'

const aprData = ref({
  currentShareValue: null,
  previousShareValue: null,
  return24h: null,
  apr: null,
  loading: true,
  error: null
})

const vaultAddress = "{{ config.contracts.pol.wberaStakerVault['mainnet-address'] }}"
const vaultABI = [
  "function previewRedeem(uint256 shares) external view returns (uint256 assets)"
]

async function calculateLiveAPR() {
  try {
    aprData.value.loading = true
    aprData.value.error = null

    // Connect to Berachain mainnet
    const provider = new ethers.JsonRpcProvider("{{ config.mainnet.rpcUrl }}")
    const vaultContract = new ethers.Contract(vaultAddress, vaultABI, provider)

    // Get current share value
    const currentBlock = await provider.getBlockNumber()
    const currentShareValue = await vaultContract.previewRedeem(ethers.parseEther("1"))

    // Get share value from 24 hours ago (assuming 12-second block time)
    const blocksPerDay = (24 * 60 * 60) / 12
    const previousBlock = currentBlock - blocksPerDay
    const previousShareValue = await vaultContract.previewRedeem(ethers.parseEther("1"), {
      blockTag: previousBlock
    })

    // Calculate APR
    const return24h = currentShareValue - previousShareValue
    const apr = (return24h * 365n * 10000n) / previousShareValue

    aprData.value = {
      currentShareValue: ethers.formatEther(currentShareValue),
      previousShareValue: ethers.formatEther(previousShareValue),
      return24h: ethers.formatEther(return24h),
      apr: Number(apr) / 100,
      loading: false,
      error: null
    }
  } catch (error) {
    aprData.value = {
      ...aprData.value,
      loading: false,
      error: error.message
    }
  }
}

onMounted(() => {
  calculateLiveAPR()
})
</script>

<div class="apr-calculator">
  <h3>Current SWBERA Vault APR</h3>

  <div v-if="aprData.loading" class="loading">
    <p>Calculating APR from blockchain data...</p>
  </div>

  <div v-else-if="aprData.error" class="error">
    <p>Error calculating APR: {{ aprData.error }}</p>
    <button @click="calculateLiveAPR" class="retry-btn">Retry</button>
  </div>

  <div v-else class="apr-results">
    <div class="apr-value">
      <strong>APR: {{ aprData.apr.toFixed(2) }}%</strong>
    </div>

    <div class="formula-calculation">
      <h4>Formula Calculation:</h4>
      <div class="formula">
        <p>$$\text{APR} = \frac{{{ aprData.currentShareValue }} - {{ aprData.previousShareValue }}}{{{ aprData.previousShareValue }}} \times 365 \times 100$$</p>
        <p>$$\text{APR} = \frac{{{ aprData.return24h }}}{{{ aprData.previousShareValue }}} \times 365 \times 100$$</p>
        <p>$$\text{APR} = {{ ((parseFloat(aprData.return24h) / parseFloat(aprData.previousShareValue)) * 365 * 100).toFixed(2) }}%$$</p>
      </div>
    </div>

    <div class="apr-details">
      <h4>Input Values:</h4>
      <p><strong>Current Share Value:</strong> {{ aprData.currentShareValue }} WBERA</p>
      <p><strong>Previous Share Value (24h ago):</strong> {{ aprData.previousShareValue }} WBERA</p>
      <p><strong>24h Return:</strong> {{ aprData.return24h }} WBERA</p>
    </div>

    <button @click="calculateLiveAPR" class="refresh-btn">Refresh</button>
  </div>
</div>

<style scoped>
.apr-calculator {
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  padding: 20px;
  margin: 20px 0;
  background: #f9fafb;
}

.loading {
  text-align: center;
  color: #6b7280;
}

.error {
  color: #dc2626;
}

.retry-btn, .refresh-btn {
  background: #3b82f6;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 4px;
  cursor: pointer;
  margin-top: 10px;
}

.retry-btn:hover, .refresh-btn:hover {
  background: #2563eb;
}

.apr-value {
  font-size: 1.5em;
  text-align: center;
  margin-bottom: 15px;
  color: #059669;
}

.formula-calculation {
  margin: 20px 0;
  padding: 15px;
  background: white;
  border-radius: 6px;
  border: 1px solid #e5e7eb;
}

.formula-calculation h4 {
  margin-top: 0;
  color: #374151;
}

.formula {
  text-align: center;
  margin: 15px 0;
}

.formula p {
  margin: 10px 0;
  font-size: 1.1em;
}

.apr-details {
  margin: 15px 0;
  padding: 15px;
  background: white;
  border-radius: 6px;
  border: 1px solid #e5e7eb;
}

.apr-details h4 {
  margin-top: 0;
  color: #374151;
}

.apr-details p {
  margin: 5px 0;
  font-size: 0.9em;
}
</style>

## Key Considerations

### Time Frame

- **Current**: 24-hour measurement period
- **Future**: Planning to move to weekly measurements for more stable APR calculations

### Precision

- All calculations use 18 decimal precision
- Share values are denominated in WBERA
- APR is calculated in basis points and converted to percentage

### Block Considerations

- Ensure you have access to historical block data
- Account for potential chain reorganizations
- Consider using multiple data points for more accurate calculations
